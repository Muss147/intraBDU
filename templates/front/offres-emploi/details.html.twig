{% extends 'front/layout.html.twig' %}

{% block title offre.titre %}

{% block stylesheets %}
<style type="text/css">
</style>
{% endblock %}

{% block body %}
<div class="max-w-screen-xl mx-auto px-4 mt-6 mb-12">
    <h2 class="text-primary text-xl font-semibold mb-4">Offres d'emploi</h2>

    <!-- Sujets les plus consultés -->
    <section class="rounded shadow pb-8 min-h-screen space-y-8 md:space-y-10">
        <div class="grid md:grid-cols-2 p-4 md:px-8 gap-4">
            <h3 class="text-2xl font-semibold md:mx-w-lg">{{offre.titre}}</h3>
            <div class="flex flex-wrap sm:flex-nowrap gap-4 justify-between md:justify-end items-center">
                <a href="mailto:?subject=Annonce consultée sur intranet.bduci.com - {{offre.titre}}&body=Bonjour,%0D%0A%0D%0AVoici une annonce sur l'Intranet qui me semble intéressante : {{offre.titre}} : {{ currentUrl|url_encode }}" target="_blank">
                    <svg class="w-10 h-10 text-primary" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 24 24">
                    <path d="M2.038 5.61A2.01 2.01 0 0 0 2 6v12a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V6c0-.12-.01-.238-.03-.352l-.866.65-7.89 6.032a2 2 0 0 1-2.429 0L2.884 6.288l-.846-.677Z"/>
                    <path d="M20.677 4.117A1.996 1.996 0 0 0 20 4H4c-.225 0-.44.037-.642.105l.758.607L12 10.742 19.9 4.7l.777-.583Z"/>
                    </svg>
                </a>
                <button id="shareDefaultButton" data-dropdown-toggle="shareDropdown">
                    <svg class="w-10 h-10 text-primary" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 24 24">
                    <path d="M17.5 3a3.5 3.5 0 0 0-3.456 4.06L8.143 9.704a3.5 3.5 0 1 0-.01 4.6l5.91 2.65a3.5 3.5 0 1 0 .863-1.805l-5.94-2.662a3.53 3.53 0 0 0 .002-.961l5.948-2.667A3.5 3.5 0 1 0 17.5 3Z"/>
                    </svg>
                </button>
                <!-- Dropdown menu -->
                <div id="shareDropdown" class="z-10 hidden bg-white divide-y divide-gray-100 border rounded-lg shadow-sm w-60">
                    <ul class="py-2 text-sm text-gray-700" aria-labelledby="shareDefaultButton">
                        <li>
                            <a href="https://www.facebook.com/sharer/sharer.php?u={{ currentUrl|url_encode }}" target="_blank" class="flex items-center gap-2 px-4 py-2 hover:bg-gray-100">
                                <svg class="w-6 h-6 text-gray-800" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 24 24">
                                    <path fill-rule="evenodd" d="M13.135 6H15V3h-1.865a4.147 4.147 0 0 0-4.142 4.142V9H7v3h2v9.938h3V12h2.021l.592-3H12V6.591A.6.6 0 0 1 12.592 6h.543Z" clip-rule="evenodd"/>
                                </svg>
                                Partager sur Facebook
                            </a>
                        </li>
                        <li>
                            <a href="https://www.linkedin.com/sharing/share-offsite/?url={{ currentUrl|url_encode }}" target="_blank" class="flex items-center gap-2 px-4 py-2 hover:bg-gray-100">
                                <svg class="w-5 h-5 text-gray-800" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 24 24">
                                    <path fill-rule="evenodd" d="M12.51 8.796v1.697a3.738 3.738 0 0 1 3.288-1.684c3.455 0 4.202 2.16 4.202 4.97V19.5h-3.2v-5.072c0-1.21-.244-2.766-2.128-2.766-1.827 0-2.139 1.317-2.139 2.676V19.5h-3.19V8.796h3.168ZM7.2 6.106a1.61 1.61 0 0 1-.988 1.483 1.595 1.595 0 0 1-1.743-.348A1.607 1.607 0 0 1 5.6 4.5a1.601 1.601 0 0 1 1.6 1.606Z" clip-rule="evenodd"/>
                                    <path d="M7.2 8.809H4V19.5h3.2V8.809Z"/>
                                </svg>
                                Partager sur Linkedin
                            </a>
                        </li>
                        <li>
                            <a href="https://twitter.com/intent/tweet?url={{ currentUrl|url_encode }}&text={{ offre.titre|url_encode }}" target="_blank" class="flex items-center gap-2 px-4 py-2 hover:bg-gray-100">
                                <svg class="w-4 h-4 text-gray-800" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 24 24">
                                    <path d="M13.795 10.533 20.68 2h-3.073l-5.255 6.517L7.69 2H1l7.806 10.91L1.47 22h3.074l5.705-7.07L15.31 22H22l-8.205-11.467Zm-2.38 2.95L9.97 11.464 4.36 3.627h2.31l4.528 6.317 1.443 2.02 6.018 8.409h-2.31l-4.934-6.89Z"/>
                                </svg>
                                Partager sur X
                            </a>
                        </li>
                    </ul>
                </div>
                <button type="button" 
                    data-modal-target="postule-modal" data-modal-toggle="postule-modal"
                    class="inline-flex items-center px-4 py-2 font-medium text-white bg-primary rounded-lg hover:bg-blue-800 focus:ring-4 focus:outline-none focus:ring-blue-300">
                    Postuler
                </button>
            </div>
        </div>
        <hr>
        <div class="p-4 md:px-8">
            <table border="0" class="">
                <tr>
                    <td class="font-semibold">Direction</td>
                    <td class="pl-1 md:pl-8"><span class="hidden sm:block">{{offre.metier.libelle}} | </span>{{offre.direction.libelle}}</td>
                </tr>
                <tr>
                    <td class="font-semibold">Date d'expiration</td>
                    <td class="pl-1 md:pl-8">{{offre.dateExpiration|date('d m Y')}}</td>
                </tr>
                <tr>
                    <td class="font-semibold">Niveau de poste</td>
                    <td class="pl-1 md:pl-8">{{offre.niveauPoste}}</td>
                </tr>
                <tr>
                    <td class="font-semibold">Niveau d'étude (diplome)</td>
                    <td class="pl-1 md:pl-8">{{offre.niveauFormation}}</td>
                </tr>
                <tr>
                    <td class="font-semibold">Expérience recherchée</td>
                    <td class="pl-1 md:pl-8">{{offre.experience}}</td>
                </tr>
                <tr>
                    <td class="font-semibold">Nombre de postes</td>
                    <td class="pl-1 md:pl-8">{{offre.postes|length < 10 ? '0' : '' }}{{offre.postes}}</td>
                </tr>
            </table>
        </div>
        <hr>
        <div class="p-4 md:px-8 space-y-4 md:space-y-8">
            <h4 class="font-semibold uppercase">Missions du poste :</h4>

            <ul class="pl-4 list-disc">
                {% for mission in offre.missions %}<li>{{mission}}</li>{% endfor %}
            </ul>


            <h4 class="font-semibold uppercase">Profil recherché :</h4>

            <ul class="pl-4 list-disc">
                {% for profil in offre.profils %}<li>{{profil}}</li>{% endfor %}
            </ul>

            <div>
                {{offre.description|raw}}
            </div>

            <div class="flex flex-col gap-4 items-start justify-center">
                <button type="button" 
                    data-modal-target="postule-modal" data-modal-toggle="postule-modal"
                    class="inline-flex items-center justify-center w-full max-w-sm px-4 py-2 font-medium text-white bg-primary rounded-lg hover:bg-blue-800 focus:ring-4 focus:outline-none focus:ring-blue-300">
                    Postuler
                </button>
                <div class="flex gap-4">
                    <a href="mailto:?subject=Annonce consultée sur intranet.bduci.com - {{offre.titre}}&body=Bonjour,%0D%0A%0D%0AVoici une annonce sur l'Intranet qui me semble intéressante : {{offre.titre}} : {{ currentUrl|url_encode }}" target="_blank">
                        <svg class="w-10 h-10 text-primary" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 24 24">
                        <path d="M2.038 5.61A2.01 2.01 0 0 0 2 6v12a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V6c0-.12-.01-.238-.03-.352l-.866.65-7.89 6.032a2 2 0 0 1-2.429 0L2.884 6.288l-.846-.677Z"/>
                        <path d="M20.677 4.117A1.996 1.996 0 0 0 20 4H4c-.225 0-.44.037-.642.105l.758.607L12 10.742 19.9 4.7l.777-.583Z"/>
                        </svg>
                    </a>
                    <button id="shareDefaultButton" data-dropdown-toggle="shareDropdown">
                        <svg class="w-10 h-10 text-primary" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 24 24">
                        <path d="M17.5 3a3.5 3.5 0 0 0-3.456 4.06L8.143 9.704a3.5 3.5 0 1 0-.01 4.6l5.91 2.65a3.5 3.5 0 1 0 .863-1.805l-5.94-2.662a3.53 3.53 0 0 0 .002-.961l5.948-2.667A3.5 3.5 0 1 0 17.5 3Z"/>
                        </svg>
                    </button>
                    <!-- Dropdown menu -->
                    <div id="shareDropdown" class="z-10 hidden bg-white divide-y divide-gray-100 border rounded-lg shadow-sm w-60">
                        <ul class="py-2 text-sm text-gray-700" aria-labelledby="shareDefaultButton">
                            <li>
                                <a href="https://www.facebook.com/sharer/sharer.php?u={{ currentUrl|url_encode }}" target="_blank" class="flex items-center gap-2 px-4 py-2 hover:bg-gray-100">
                                    <svg class="w-6 h-6 text-gray-800" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 24 24">
                                        <path fill-rule="evenodd" d="M13.135 6H15V3h-1.865a4.147 4.147 0 0 0-4.142 4.142V9H7v3h2v9.938h3V12h2.021l.592-3H12V6.591A.6.6 0 0 1 12.592 6h.543Z" clip-rule="evenodd"/>
                                    </svg>
                                    Partager sur Facebook
                                </a>
                            </li>
                            <li>
                                <a href="https://www.linkedin.com/sharing/share-offsite/?url={{ currentUrl|url_encode }}" target="_blank" class="flex items-center gap-2 px-4 py-2 hover:bg-gray-100">
                                    <svg class="w-5 h-5 text-gray-800" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 24 24">
                                        <path fill-rule="evenodd" d="M12.51 8.796v1.697a3.738 3.738 0 0 1 3.288-1.684c3.455 0 4.202 2.16 4.202 4.97V19.5h-3.2v-5.072c0-1.21-.244-2.766-2.128-2.766-1.827 0-2.139 1.317-2.139 2.676V19.5h-3.19V8.796h3.168ZM7.2 6.106a1.61 1.61 0 0 1-.988 1.483 1.595 1.595 0 0 1-1.743-.348A1.607 1.607 0 0 1 5.6 4.5a1.601 1.601 0 0 1 1.6 1.606Z" clip-rule="evenodd"/>
                                        <path d="M7.2 8.809H4V19.5h3.2V8.809Z"/>
                                    </svg>
                                    Partager sur Linkedin
                                </a>
                            </li>
                            <li>
                                <a href="https://twitter.com/intent/tweet?url={{ currentUrl|url_encode }}&text={{ offre.titre|url_encode }}" target="_blank" class="flex items-center gap-2 px-4 py-2 hover:bg-gray-100">
                                    <svg class="w-4 h-4 text-gray-800" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 24 24">
                                        <path d="M13.795 10.533 20.68 2h-3.073l-5.255 6.517L7.69 2H1l7.806 10.91L1.47 22h3.074l5.705-7.07L15.31 22H22l-8.205-11.467Zm-2.38 2.95L9.97 11.464 4.36 3.627h2.31l4.528 6.317 1.443 2.02 6.018 8.409h-2.31l-4.934-6.89Z"/>
                                    </svg>
                                    Partager sur X
                                </a>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </section>


    <!-- Main modal -->
    <div id="postule-modal" tabindex="-1" aria-hidden="true" class="hidden overflow-y-auto overflow-x-hidden fixed top-0 right-0 left-0 z-50 justify-center items-center w-full md:inset-0 h-[calc(100%-1rem)] max-h-full">
        <div class="relative p-4 w-full max-w-2xl max-h-full">
            <!-- Modal content -->
            <div class="relative bg-white rounded-lg shadow-sm">
                <!-- Modal header -->
                <div class="flex items-center justify-between p-4 md:p-5 border-b rounded-t border-gray-200">
                    <h3 class="text-xl font-semibold text-gray-900">
                        Postuler à l'offre
                    </h3>
                    <button type="button" class="text-gray-400 bg-transparent hover:bg-gray-200 hover:text-gray-900 rounded-lg text-sm w-8 h-8 ms-auto inline-flex justify-center items-center" data-modal-hide="postule-modal">
                        <svg class="w-3 h-3" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 14 14">
                            <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m1 1 6 6m0 0 6 6M7 7l6-6M7 7l-6 6"/>
                        </svg>
                        <span class="sr-only">Close modal</span>
                    </button>
                </div>
                <!-- Modal body -->
                <div class="p-4 md:p-5 space-y-4">
                    {{form_start(form, {'attr': {'class': ''}})}}
                        <div class="grid gap-6 mb-6 md:grid-cols-2">
                            <div>
                                <label for="postuler_form[nomAgent]" class="block mb-2 text-sm font-medium text-gray-900">Nom & prénoms</label>
                                {{form_widget(form.nomAgent, {'attr': {'class': 'bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5', 'placeholder': 'Votre nom et prénoms'}})}}
                            </div>
                            <div>
                                <label for="postuler_form[posteOccupe]" class="block mb-2 text-sm font-medium text-gray-900">Poste occupé</label>
                                {{form_widget(form.posteOccupe, {'attr': {'class': 'bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5', 'placeholder': 'Le poste que vous occupé'}})}}
                            </div>
                            <div>
                                <label for="postuler_form[email]" class="block mb-2 text-sm font-medium text-gray-900">Adresse Email</label>
                                {{form_widget(form.email, {'attr': {'class': 'bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5', 'placeholder': 'Votre adresse email'}})}}
                            </div>
                            <div>
                                <label for="postuler_form[telephone]" class="block mb-2 text-sm font-medium text-gray-900">Numéro de téléphone</label>
                                {{form_widget(form.telephone, {'attr': {'class': 'bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5', 'placeholder': 'Votre numéro de téléphone'}})}}
                            </div>
                            <div class="md:col-span-2">
                                <label for="postuler_form[cv]" class="block mb-2 text-sm font-medium text-gray-900">Curriculum vitae</label>
                                {{form_widget(form.cv, {'attr': {'class': 'block w-full text-sm border border-gray-300 rounded-lg cursor-pointer bg-gray-50 focus:outline-none', 'multiple': 'multiple'}})}}
                                <p class="mt-1 text-sm text-gray-500" id="file_input_help">PDF, WORD, JPG or PNG (MAX. 800x400px).</p>
                            </div>
                            <div class="md:col-span-2">
                                <label for="postuler_form[motivations]" class="block mb-2 text-sm font-medium text-gray-900">Motivations</label>
                                {{form_widget(form.motivations, {'attr': {'class': 'bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5', 'rows': '8', 'placeholder': 'Nous vous écoutons'}})}}
                            </div>
                        </div>
                        <div class="flex justify-center mb-6 md:grid-cols-2">
                            <button type="submit" class="w-full max-w-sm text-center mx-auto inline-flex justify-center items-center px-4 py-3 text-sm font-medium text-white bg-primary rounded-lg hover:bg-blue-800 focus:ring-4 focus:outline-none focus:ring-blue-300">Soumettre</button>
                        </div>
                    {{form_end(form)}}
                </div>
            </div>
        </div>
    </div>
    <!-- Notification messages -->
    {% for label, messages in app.flashes %}
        {% for message in messages %}
            <div id="flash-modal" class="fixed inset-0 flex items-center justify-center z-50 bg-black/50">
                <div class="max-w-md w-full p-4 rounded-lg shadow-lg
                    {% if label == 'success' %}
                        bg-green-50 text-green-800 border border-green-300
                    {% elseif label == 'error' %}
                        bg-red-50 text-red-800 border border-red-300
                    {% endif %}">
                    <div class="flex items-center">
                        <svg class="shrink-0 w-4 h-4 me-2" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M10 .5a9.5 9.5 0 1 0 9.5 9.5A9.51 9.51 0 0 0 10 .5ZM9.5 4a1.5 1.5 0 1 1 0 3 1.5 1.5 0 0 1 0-3ZM12 15H8a1 1 0 0 1 0-2h1v-3H8a1 1 0 0 1 0-2h2a1 1 0 0 1 1 1v4h1a1 1 0 0 1 0 2Z"/>
                        </svg>
                        <h3 class="text-lg font-semibold">
                            {% if label == 'success' %} Succès {% else %} Erreur {% endif %}
                        </h3>
                    </div>
                    <p class="mt-2 text-sm">{{ message|raw }}</p>
                    <div class="mt-4 flex">
                        <button onclick="closeFlashModal()" class="px-4 py-2 text-xs font-medium rounded-lg
                            {% if label == 'success' %}
                                bg-green-800 text-white hover:bg-green-900
                            {% else %}
                                bg-red-800 text-white hover:bg-red-900
                            {% endif %}">
                            Fermer
                        </button>
                    </div>
                </div>
            </div>
        {% endfor %}
    {% endfor %}
</div>
{% endblock %}

{% block javascripts %}
{{ parent() }}
<script>
    // Déclarer globalement
    function closeFlashModal() {
        const modal = document.getElementById('flash-modal');
        if (modal) modal.remove();
    }

    // Exécuter automatiquement après le chargement Turbo
    document.addEventListener('turbo:load', function () {
        setTimeout(() => closeFlashModal(), 5000);

        const modalButtons = document.querySelectorAll('[data-modal-toggle]');
        modalButtons.forEach((btn) => {
            btn.addEventListener('click', (e) => {
                const targetId = btn.getAttribute('data-modal-toggle');
                const modalElement = document.getElementById(targetId);
                if (modalElement) {
                    const modal = new Modal(modalElement);
                    modal.show();
                }
            });
        });
    });
</script>
{% endblock %}